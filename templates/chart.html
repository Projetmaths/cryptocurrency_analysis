{% extends "base.html" %}
{% block title %} Cryptotrading {% endblock %}

{% block script %}
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js" integrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.min.js" integrity="sha384-pQQkAEnwaBkjpqZ8RU1fF1AKtTcHJwFl3pblpTlHXybJjHpMYo79HY3hIi4NKxyj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
{% endblock %}

{% block link %}
<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/index.css') }}">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css">
<link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
{% endblock %}

{% block content %}
<div class="content">
	<div class="sidebar">
		<div class="menu">
			<div class="menu-first">
				<div class="menu-title"><i class="fab fa-btc"></i> Cryptocurrency analysis</div>
				<div class="menu-subtitle"><i class="fas fa-tachometer-alt"></i> <a href="/">Dashboard</a></div>
			</div>
			<div class="menu-second">
				<div class="menu-title">Analysis</div>
				<div class="menu-subtitle"><i class="fas fa-chart-bar"></i> <a href="/chart">Charts</a></div>
				<div class="menu-subtitle"><i class="fas fa-table"></i> Tables</div>
			</div>
		</div>
	</div>
	<div class="dashboard">
		<div class="dash-title">Charts</div>
		<div class="dash-datatable">
			<div class="dash-datatable-title"><i class="fas fa-table"></i> DataTable example</div>
			<div class="dash-datatable-container">

				<div style="width: 75%">
					<h2 titre="1">Bitcoin</h2>
					<div graph="1" class="dropdown">
						<canvas id="myChart1"></canvas>
					</div>
				</div>
				<br>

				<div style="width: 75%">
					<h2 titre="2">Ethereum</h2>
					<div graph="2" class="dropdown">
						<canvas id="myChart2"></canvas>
					</div>
				</div>
				<br>

				<div style="width: 75%">
					<h2 titre="3">Binance Coin</h2>
					<div graph="3" class="dropdown">
						<canvas id="myChart3"></canvas>
					</div>
				</div>
				<br>

				<div style="width: 75%">
					<h2 titre="4">Tether</h2>
					<div graph="4" class="dropdown">
						<canvas id="myChart4"></canvas>
					</div>
				</div>
				<br>

				<div style="width: 75%">
					<h2 titre="5">Cardano</h2>
					<div graph="5" class="dropdown">
						<canvas id="myChart5"></canvas>
					</div>
				</div>
				<br>

				<div style="width: 75%">
					<h2 titre="6">Polkadot</h2>
					<div graph="6" class="dropdown">
						<canvas id="myChart6"></canvas>
					</div>
				</div>
				<br>

				<div style="width: 75%">
					<h2 titre="7">XRP</h2>
					<div graph="7" class="dropdown">
						<canvas id="myChart7"></canvas>
					</div>
				</div>
				<br>

				<div style="width: 75%">
					<h2 titre="8">Uniswap</h2>
					<div graph="8" class="dropdown">
						<canvas id="myChart8"></canvas>
					</div>
				</div>
				<br>

				<div style="width: 75%">
					<h2 titre="9">Litecoin</h2>
					<div graph="9" class="dropdown">
						<canvas id="myChart9"></canvas>
					</div>
				</div>
				<br>

				<div style="width: 75%">
					<h2 titre="10">Chainlink</h2>
					<div graph="10" class="dropdown">
						<canvas id="myChart10"></canvas>
					</div>
				</div>
				<br>

				<div style="width: 75%">
					<h2 titre="11">Bitcoin Cash</h2>
					<div graph="11" class="dropdown">
						<canvas id="myChart11"></canvas>
					</div>
				</div>
				<br>

				<div style="width: 75%">
					<h2 titre="12">Stellar</h2>
					<div graph="12" class="dropdown">
						<canvas id="myChart12"></canvas>
					</div>
				</div>
				<br>

				<div style="width: 75%">
					<h2 titre="13">USD Coin</h2>
					<div graph="13" class="dropdown">
						<canvas id="myChart13"></canvas>
					</div>
				</div>
				<br>

				<div style="width: 75%">
					<h2 titre="14">Wrapped Bitcoin</h2>
					<div graph="14" class="dropdown">
						<canvas id="myChart14"></canvas>
					</div>
				</div>
				<br>

				<div style="width: 75%">
					<h2 titre="15">Dogecoin</h2>
					<div graph="15" class="dropdown">
						<canvas id="myChart15"></canvas>
					</div>
				</div>


				<script>
					var labels = {{labels|tojson}};
					var prices = {{data|tojson}};
					var nb_csv = {{lim}};
					var rows = {{count}};
					var names = {{name|tojson}};
					var symbols = {{symbol|tojson}};
					var nb_lignes = nb_csv*rows;
					var nom_tmp = '';
				
					console.log("==================================================")
					console.log("Paramètres")
					console.log(rows);
					console.log(nb_csv);
					console.log("==================================================")
				
					var tab = [];
					for (var i = 0; i < (nb_lignes); i++) { //nb_csv*rows donnera le nombre total de lignes présentes à travers tous									
						if(i%rows==0){
							console.log("changement"); //Ici on peut séparer les données avec de l'html jsp mais les données dans
													   //le console.log sont bien séparées au modulo du nombre de lignes du csv.
													   //Et vu qu'ils se remplissent à la même vitesse les séparations seront
													   //toujours bien réparties.
							//console.log('---'+names[i],prices[i],i+'---');
							nom_tmp = names[i];
						}
						if(nom_tmp==nom_tmp){
							//tab.push(nom_tmp);
							tab.push(prices[i]);
							tab.push(labels[i]);
						}
					}
				
					console.log(tab);
					for ( var i = 1 ; i <= (nb_csv) ; i++) {
						console.log(i);
						var ctx = document.getElementById('myChart'+i+'').getContext('2d');
						var data = {
								labels: [
										{% for row in rows %}	
											tab[i],
										{% endfor %}
								],
								datasets: [{
									label: 'Price',
									data: [
										  {% for row in rows %}
											  tab[i-1],
										  {% endfor %}
									]
								}]};
						var config = {
							type: 'line',
							data: data,
						};
				
						var chart = new Chart(ctx, config);
						//console.log(i)
						i++
					}; 	
				
					$("[titre]").click(function(){
						var affiche = $(this).attr("titre");
						$("[graph='" +affiche+"']").toggle();
					})
				</script>
			</div>
		</div>
	</div>
</div>
{% endblock %}